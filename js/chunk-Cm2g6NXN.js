import{d as e,l as t,a4 as a,u as l,w as s,z as i,K as n,o,R as u,h as r,r as c,a as p,g as d,T as m,Y as b,b as v,v as f,x as g,c as y,n as k,V as h,W as x,i as C}from"./chunk-CbJvKZ2B.js";import{_ as w}from"./chunk-BBoLewOg.js";import{u as _,d as M}from"./chunk-BnIIHKLx.js";import{_ as j}from"./chunk-DPGgRTcy.js";import"./chunk-DsM932Ci.js";const N={class:"flex flex-col items-center gap-6 w-full px-12"},U=["disabled"],D=e({__name:"UploadDialog",props:{visible:{type:Boolean,required:!0},visibleModifiers:{}},emits:["update:visible"],setup(e){const{t:g}=t(),y=a.useToast(),k=c("audio/*"),h=l(e,"visible"),x=_().globalConfig,C=s.createInstance({name:"audioStore"}),w=c(null),D=v({get:()=>w.value?.fileName||null,set(e){w.value&&e&&(w.value.fileName=e)}}),I=c();async function S(e){if(!e)return void(w.value=null);/audio*/.test(e?.type||"")?w.value=e:y.open({message:g("error.notAudioFile"),type:"error",position:"top-right"})}function F(){if(w.value){const{data:e,fileName:t}=w.value,a=f();C.setItem(a,{data:e,fileName:t}).then(()=>{y.open({message:g("error.uploadSuccess"),type:"success",position:"top-right"}),async function(){(await C.keys()).length>0&&C.iterate((e,t)=>{x.addMusic({id:t,name:e.fileName,url:"Storage"})})}()}).catch(()=>{y.open({message:g("error.uploadFail"),type:"error",position:"top-right"})})}}return i(h,e=>{e&&I.value.showDialog()}),(e,t)=>(o(),n(M,{ref_key:"uploadDialogRef",ref:I,visible:h.value,"onUpdate:visible":t[1]||(t[1]=e=>h.value=e),title:r(g)("dialog.uploadAudioTitle"),"submit-func":F,class:""},{content:u(()=>[p("div",N,[h.value?(o(),n(j,{key:0,"limit-type":k.value,onUploadFile:S},null,8,["limit-type"])):d("",!0),m(p("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>D.value=e),disabled:null===w.value,type:"text",class:"input w-full"},null,8,U),[[b,D.value]])])]),_:1},8,["visible","title"]))}}),I={class:"flex gap-3"},S={for:"explore"},F={class:"p-0"},L=["title"],T={class:"link hover:text-primary"},A={class:"flex gap-3"},R=["onClick"],V=["onClick"],q=e({__name:"index",setup(e){const{t:a}=t(),l=s.createInstance({name:"audioStore"}),i=_().globalConfig,{getMusicList:n}=g(i),d=c(n),m=c(!1);function b(){i.resetMusicList(),l.clear()}function v(){i.clearMusicList(),l.clear()}return(e,t)=>(o(),y(h,null,[k(D,{visible:m.value,"onUpdate:visible":t[0]||(t[0]=e=>m.value=e)},null,8,["visible"]),p("div",null,[k(w,{title:r(a)("sidebar.musicManagement")},{buttons:u(()=>[p("div",I,[p("button",{class:"btn btn-primary btn-sm",onClick:b},C(r(a)("button.reset")),1),p("label",S,[p("span",{class:"btn btn-primary btn-sm",onClick:t[1]||(t[1]=e=>m.value=!0)},C(r(a)("button.upload")),1)]),p("button",{class:"btn btn-error btn-sm",onClick:v},C(r(a)("button.allDelete")),1)])]),_:1},8,["title"]),p("div",null,[p("ul",F,[(o(!0),y(h,null,x(d.value,e=>(o(),y("li",{key:e.id,class:"flex items-center gap-6 pb-2 mb-3"},[p("div",{class:"mr-12 overflow-hidden w-72 whitespace-nowrap text-ellipsis",title:e.name},[p("a",T,C(e.name),1)],8,L),p("div",A,[p("button",{class:"btn btn-primary btn-xs",onClick:t=>async function(e){i.setCurrentMusic(e,!1)}(e)},C(r(a)("button.play")),9,R),p("button",{class:"btn btn-error btn-xs",onClick:t=>function(e){i.removeMusic(e.id),l.removeItem(e.name)}(e)},C(r(a)("button.delete")),9,V)])]))),128))])])])],64))}});export{q as default};
