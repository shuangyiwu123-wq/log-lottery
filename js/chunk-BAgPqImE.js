import{d as e,c as a,o as t,a as l,r as n,g as s,j as o,m as r,l as i,u as d,T as p,i as u,h as c,Y as b,am as m,a4 as g,x as f,s as v,v as h,an as y,ao as w,k as x,n as D,R as P,V as k,_}from"./chunk-CbJvKZ2B.js";import{_ as T}from"./chunk-CZpyGWKK.js";import{i as C,u as A,b as R,l as O,d as L}from"./chunk-BnIIHKLx.js";import{_ as N}from"./chunk-BBoLewOg.js";import{r as j,a as z}from"./chunk-DsM932Ci.js";const W={class:"drawer drawer-end h-0 w-0"},S={class:"drawer-content w-0 h-0 absolute"},V={class:"drawer-side"},F={key:0,class:"menu bg-base-200 min-h-full w-80 p-4"},U=e({__name:"index",setup(e,{expose:r}){const i=n(null),d=n(!1);return r({showDrawer:function(){i.value?.click(),d.value=!0},closeDrawer:function(){i.value?.click(),d.value=!1}}),(e,n)=>(t(),a("div",W,[n[1]||(n[1]=l("input",{id:"my-drawer-1",type:"checkbox",class:"drawer-toggle"},null,-1)),l("div",S,[l("label",{ref_key:"drawerTriggerRef",ref:i,for:"my-drawer-1"},null,512)]),l("div",V,[n[0]||(n[0]=l("label",{for:"my-drawer-1","aria-label":"close sidebar",class:"drawer-overlay"},null,-1)),d.value?(t(),a("div",F,[o(e.$slots,"content")])):s("",!0)])]))}}),$={class:"fieldset"},E={class:"label"},q=["placeholder"],I={class:"fieldset"},J={class:"label",required:""},M=["placeholder"],Y={class:"validator-hint hidden"},B={class:"fieldset"},G={class:"label"},H=["placeholder"],K={class:"fieldset"},Q={class:"label"},X=["placeholder"],Z={class:"fieldset"},ee={class:"label"},ae=["placeholder"],te={class:"btn btn-neutral mt-4",type:"submit"},le=e({__name:"SinglePerson",props:r({addOnePersonDrawerRef:{},addOnePerson:{type:Function}},{singlePersonData:{required:!0},singlePersonDataModifiers:{}}),emits:["update:singlePersonData"],setup(e){const{t:n}=i(),s=d(e,"singlePersonData");return(o,r)=>(t(),a("form",{class:"fieldset rounded-box w-xs p-4",onSubmit:r[6]||(r[6]=a=>e.addOnePerson(e.addOnePersonDrawerRef,a))},[l("label",$,[l("span",E,u(c(n)("table.number")),1),p(l("input",{"onUpdate:modelValue":r[0]||(r[0]=e=>s.value.uid=e),type:"text",class:"input validator",placeholder:c(n)("table.number")},null,8,q),[[b,s.value.uid]])]),l("fieldset",I,[l("label",J,[m(u(c(n)("table.name")),1),r[7]||(r[7]=l("span",{class:"text-red-500"},"*",-1))]),p(l("input",{"onUpdate:modelValue":r[1]||(r[1]=e=>s.value.name=e),type:"text",class:"input validator",placeholder:c(n)("table.name"),required:"",minlength:"1"},null,8,M),[[b,s.value.name]]),l("p",Y,u(c(n)("error.personNameEmpty")),1)]),l("label",B,[l("span",G,u(c(n)("table.department")),1),p(l("input",{"onUpdate:modelValue":r[2]||(r[2]=e=>s.value.department=e),type:"text",class:"input validator",placeholder:c(n)("table.department")},null,8,H),[[b,s.value.department]])]),l("label",K,[l("span",Q,u(c(n)("table.avatar")),1),p(l("input",{"onUpdate:modelValue":r[3]||(r[3]=e=>s.value.avatar=e),type:"text",class:"input validator",placeholder:c(n)("table.avatar")},null,8,X),[[b,s.value.avatar]])]),l("label",Z,[l("span",ee,u(c(n)("table.identity")),1),p(l("input",{"onUpdate:modelValue":r[4]||(r[4]=e=>s.value.identity=e),type:"text",class:"input validator",placeholder:c(n)("table.identity")},null,8,ae),[[b,s.value.identity]])]),l("button",te,u(c(n)("button.confirm")),1),l("button",{class:"btn btn-ghost mt-1",type:"reset",onClick:r[5]||(r[5]=a=>e.addOnePersonDrawerRef.closeDrawer())},u(c(n)("button.cancel")),1)],32))}});function ne(e){return new Worker("/log-lottery/assets/importExcel.worker-CWYp5aq3.js",{name:e?.name})}function se({exportInputFileRef:e}){const{t:a}=i(),t="/log-lottery/".replace("./","/"),l=g.useToast(),s=new ne,o=x(O),r=A().personConfig,{getAllPersonList:d,getAlreadyPersonList:p}=f(r),u=(c={handleDeletePerson:function(e){r.deletePerson(e)}},[{label:C.global.t("data.number"),props:"uid"},{label:C.global.t("data.name"),props:"name"},{label:C.global.t("data.department"),props:"department"},{label:C.global.t("data.avatar"),props:"avatar",formatValue:e=>e.avatar?`<img src="${e.avatar}" alt="avatar" style="width: 50px; height: 50px;"/>`:"-"},{label:C.global.t("data.identity"),props:"identity"},{label:C.global.t("data.isWin"),props:"isWin",formatValue:e=>e.isWin?C.global.t("data.yes"):C.global.t("data.no")},{label:C.global.t("data.operation"),actions:[{label:C.global.t("data.delete"),type:"btn-error",onClick:e=>{c.handleDeletePerson(e)}}]}]);var c;const b=n(!1),m=n({uid:"",name:"",department:"",avatar:"",identity:""});async function D(){if("zhCn"===C.global.locale.value){return await z(`${t}人口登记表-zhCn.xlsx`)}return await z(`${t}personListTemplate-en.xlsx`)}async function P(e){var a;o?.show(),D(),a={type:"start",data:e,templateData:await D()},s&&s.postMessage(a)}return{resetData:function(){r.resetAlreadyPerson()},deleteAll:function(){r.deleteAllPerson()},handleFileChange:async function(t){s&&(s.onmessage=t=>{if("done"===t.data.type&&(r.resetPerson(),r.addNotPersonList(t.data.data),l.open({message:a("error.importSuccess"),type:"success",position:"top-right"}),e.value&&(e.value.value="")),"error"===t.data.type){if("not right template"===t.data.message)return void l.open({message:a("error.excelFileError"),type:"error",position:"top-right"});l.open({message:t.data.message||a("error.importFail"),type:"error",position:"top-right"})}o?.hide()}),P(await j(t.target.files[0]))},exportData:function(){let e=JSON.parse(JSON.stringify(d.value));for(let t=0;t<e.length;t++)delete e[t].x,delete e[t].y,delete e[t].id,delete e[t].createTime,delete e[t].updateTime,delete e[t].prizeId,e[t].isWin?e[t].isWin=C.global.t("data.yes"):e[t].isWin=C.global.t("data.no"),e[t].prizeTime=e[t].prizeTime.join(","),e[t].prizeName=e[t].prizeName.join(",");let a=JSON.stringify(e);if(a=a.replaceAll(/uid/g,C.global.t("data.number")).replaceAll(/isWin/g,C.global.t("data.isWin")).replaceAll(/department/g,C.global.t("data.department")).replaceAll(/name/g,C.global.t("data.name")).replaceAll(/identity/g,C.global.t("data.identity")).replaceAll(/prizeName/g,C.global.t("data.prizeName")).replaceAll(/prizeTime/g,C.global.t("data.prizeTime")),e=JSON.parse(a),e.length>0){const a=y.json_to_sheet(e),t=y.book_new();y.book_append_sheet(t,a,"Sheet1"),w(t,"data.xlsx")}},alreadyPersonList:p,allPersonList:d,tableColumnList:u,addOnePerson:function(e,a){a.preventDefault();const t=R([v(m.value)]);t[0].id=h(),r.addOnePerson(t),e.closeDrawer(),m.value={}},addPersonModalVisible:b,singlePersonData:m,downloadTemplate:function(){const e=C.global.t("data.xlsxName");fetch(`${t}${e}`).then(e=>e.blob()).then(t=>{const n=window.URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=e,s.click(),l.open({message:a("error.downloadSuccess"),type:"success",position:"top-right"})})}}}const oe={class:"min-w-1000px"},re={class:"flex gap-3"},ie=["data-tip"],de={class:""},pe={for:"explore"},ue=["data-tip"],ce={class:"btn btn-primary btn-sm"},be=e({__name:"index",setup(e){const s=n(),o=n(),r=n(),d=n(),{resetData:p,deleteAll:b,handleFileChange:m,exportData:g,addOnePerson:f,singlePersonData:v,alreadyPersonList:h,allPersonList:y,tableColumnList:w,downloadTemplate:x}=se({exportInputFileRef:r}),{t:C}=i();return(e,n)=>(t(),a(k,null,[D(L,{ref_key:"resetDataDialogRef",ref:s,title:c(C)("dialog.titleTip"),desc:c(C)("dialog.dialogResetWinner"),"submit-func":c(p)},null,8,["title","desc","submit-func"]),D(L,{ref_key:"delAllDataDialogRef",ref:o,title:c(C)("dialog.titleTip"),desc:c(C)("dialog.dialogDelAllPerson"),"submit-func":c(b)},null,8,["title","desc","submit-func"]),D(U,{ref_key:"addOnePersonDrawerRef",ref:d},{content:P(()=>[D(le,{"single-person-data":c(v),"onUpdate:singlePersonData":n[0]||(n[0]=e=>_(v)?v.value=e:null),"add-one-person-drawer-ref":d.value,"add-one-person":c(f)},null,8,["single-person-data","add-one-person-drawer-ref","add-one-person"])]),_:1},512),l("div",oe,[D(N,{title:c(C)("viewTitle.personManagement")},{buttons:P(()=>[l("div",re,[l("button",{class:"btn btn-error btn-sm",onClick:n[1]||(n[1]=e=>o.value.showDialog())},u(c(C)("button.allDelete")),1),l("div",{class:"tooltip tooltip-bottom","data-tip":c(C)("tooltip.downloadTemplateTip")},[l("button",{class:"no-underline btn btn-secondary btn-sm",onClick:n[2]||(n[2]=(...e)=>c(x)&&c(x)(...e))},u(c(C)("button.downloadTemplate")),1)],8,ie),l("div",de,[l("label",pe,[l("div",{class:"tooltip tooltip-bottom","data-tip":c(C)("tooltip.uploadExcelTip")},[l("input",{id:"explore",ref_key:"exportInputFileRef",ref:r,type:"file",class:"",style:{display:"none"},accept:".xlsx,.xls",onChange:n[3]||(n[3]=(...e)=>c(m)&&c(m)(...e))},null,544),l("span",ce,u(c(C)("button.importData")),1)],8,ue)])]),l("button",{class:"btn btn-error btn-sm",onClick:n[4]||(n[4]=e=>s.value.showDialog())},u(c(C)("button.resetData")),1),l("button",{class:"btn btn-accent btn-sm",onClick:n[5]||(n[5]=(...e)=>c(g)&&c(g)(...e))},u(c(C)("button.exportResult")),1),l("button",{class:"btn btn-neutral btn-sm",onClick:n[6]||(n[6]=e=>d.value.showDrawer())},u(c(C)("button.add")),1),l("div",null,[l("span",null,u(c(C)("table.luckyPeopleNumber"))+":",1),l("span",null,u(c(h).length),1),n[7]||(n[7]=l("span",null," / ",-1)),l("span",null,u(c(y).length),1)])])]),_:1},8,["title"]),D(T,{"table-columns":c(w),data:c(y)},null,8,["table-columns","data"])])],64))}});export{be as default};
