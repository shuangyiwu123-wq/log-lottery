import{d as e,l as a,u as l,w as s,z as t,c as i,o as n,V as o,a as u,n as r,g as v,r as c,i as m,h as d,R as p,v as g,K as f,T as b,Y as h,b as k,x as y,W as w}from"./chunk-CbJvKZ2B.js";import{u as x,d as I,g as _}from"./chunk-BnIIHKLx.js";import{_ as N}from"./chunk-BBoLewOg.js";import{_ as j}from"./chunk-DPGgRTcy.js";import"./chunk-DsM932Ci.js";const C={class:"toast toast-top toast-end"},S={key:0,class:"alert alert-error"},U={key:1,class:"alert alert-success"},D={key:2,class:"alert alert-error"},T={class:"flex flex-col items-center gap-6 w-full px-12"},q=["disabled","placeholder"],F=e({__name:"UploadDialog",props:{visible:{type:Boolean,required:!0},visibleModifiers:{}},emits:["update:visible"],setup(e){const{t:y}=a(),w=c("image/*"),_=c(0),N=l(e,"visible"),F=x().globalConfig,M=s.createInstance({name:"imgStore"}),R=c(null),V=k({get:()=>R.value?.fileName||null,set(e){R.value&&e&&(R.value.fileName=e)}}),z=c();async function B(e){if(!e)return void(R.value=null);/image*/.test(e?.type||"")?R.value=e:_.value=3}function H(){if(R.value){const{data:e,fileName:a}=R.value,l=g();M.setItem(l,{data:e,fileName:a}).then(()=>{_.value=1,async function(){(await M.keys()).length>0&&M.iterate((e,a)=>{F.addImage({id:a,name:e.fileName,url:"Storage"})})}()}).catch(()=>{_.value=2})}}return t(N,e=>{e&&z.value.showDialog()}),(e,a)=>(n(),i(o,null,[u("div",C,[2===_.value?(n(),i("div",S,[u("span",null,m(d(y)("error.uploadFail")),1)])):v("",!0),1===_.value?(n(),i("div",U,[u("span",null,m(d(y)("error.uploadSuccess")),1)])):v("",!0),3===_.value?(n(),i("div",D,[u("span",null,m(d(y)("error.notImage")),1)])):v("",!0)]),r(I,{ref_key:"uploadDialogRef",ref:z,visible:N.value,"onUpdate:visible":a[1]||(a[1]=e=>N.value=e),title:d(y)("dialog.uploadImageTitle"),"submit-func":H,class:""},{content:p(()=>[u("div",T,[N.value?(n(),f(j,{key:0,"limit-type":w.value,onUploadFile:B},null,8,["limit-type"])):v("",!0),b(u("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e),disabled:null===R.value,type:"text",placeholder:d(y)("placeHolder.imageName"),class:"input w-full"},null,8,q),[[h,V.value]])])]),_:1},8,["visible","title"])],64))}}),M={class:""},R={for:"explore"},V={class:"p-0"},z={class:"flex items-center gap-8"},B={class:"avatar h-14"},H={class:"w-12 h-12 mask mask-squircle hover:w-14 hover:h-14"},K={class:"w-64"},L={class:"overflow-hidden font-bold whitespace-nowrap text-ellipsis"},W=["onClick"],Y=e({__name:"index",setup(e){const{t:l}=a(),v=x().globalConfig,{getImageList:g}=y(v),f=c(0),b=s.createInstance({name:"imgStore"}),h=c(!1);return t(()=>f.value,e=>{0!==e&&setTimeout(()=>{f.value=0},2e3)}),(e,a)=>(n(),i(o,null,[r(F,{visible:h.value,"onUpdate:visible":a[0]||(a[0]=e=>h.value=e)},null,8,["visible"]),u("div",null,[r(N,{title:d(l)("sidebar.imagesManagement")},{buttons:p(()=>[u("div",M,[u("label",R,[u("span",{class:"btn btn-primary btn-sm",onClick:a[1]||(a[1]=e=>h.value=!0)},m(d(l)("button.upload")),1)])])]),_:1},8,["title"]),u("ul",V,[(n(!0),i(o,null,w(d(g),e=>(n(),i("li",{key:e.id,class:"mb-3"},[u("div",z,[u("div",B,[u("div",H,[r(_,{"img-item":e},null,8,["img-item"])])]),u("div",K,[u("div",L,m(e.name),1)]),u("div",null,[u("button",{class:"btn btn-error btn-xs",onClick:a=>function(e){"Storage"===e.url&&b.removeItem(e.id).then(()=>{v.removeImage(e.id)}),v.removeImage(e.id)}(e)},m(d(l)("button.delete")),9,W)])])]))),128))])])],64))}});export{Y as default};
